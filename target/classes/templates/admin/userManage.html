<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Material Design Bootstrap</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <!-- Material Design Bootstrap -->
    <link rel="stylesheet" th:href="@{/css/mdb.min.css}">
    <!-- Your custom styles (optional) -->

    <style>
        /* Only for snippet */
        .double-nav .breadcrumb-dn {
            color: #fff;
        }

        .button-collapse i {
            color: #fff
        }
    </style>
</head>


<body class="fixed-sn black-skin">

<!--Main Navigation-->
<header>

    <th:block th:include="/admin/_menu"></th:block>

</header>
<!--Main Navigation-->

<!--Main Layout-->
<!-- Main layout  -->
<main class="p-0">
    <div class="container-fluid mb-5">
        <setion>
            <div class="card">
                <div class="card-body">
                    <div class="row">

                        <div class="col-sm">
                            <H3 class="my-auto float-left">List account</H3>
                        </div>
                        <div class="col-sm">
                            <button class="btn btn-success float-right" data-toggle="modal" data-target="#modalAdd" onclick="$('#formMaster')[0].reset()">New
                                user
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </setion>
        <section>

            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <!-- Table -->
                        <table class="table">

                            <!-- Table head -->
                            <thead class="mdb-color darken-3">
                            <tr class="text-white">
                                <th>#</th>
                                <th>Username</th>
                                <th>Password</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Date created</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                            </thead>
                            <!-- Table head -->

                            <!-- Table body -->
                            <tbody id="dataUser">

                            </tbody>
                            <!-- Table body -->
                        </table>
                        <!-- Table -->
                    </div>


                </div>
            </div>

        </section>
        <section>
            <div class="modal fade" id="modalAdd" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog cascading-modal" role="document">
                    <!-- Content -->
                    <div class="modal-content">

                        <!-- Header -->
                        <div class="modal-header light-blue darken-3 white-text">
                            <h4 class=""><i class="fas fa-pencil-alt"></i> Account</h4>
                            <button type="button" class="close waves-effect waves-light" data-dismiss="modal"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <!-- Body -->
                        <form id="formMaster">
                            <div class="modal-body mb-0">
                                <div class="md-form form-sm">
                                    <i class="fas fa-user prefix"></i>
                                    <input placeholder="Enter username" name="username" type="text" id="usernameUser" class="form-control form-control-sm">
                                    <label for="usernameUser">Username</label>
                                </div>
                                <div class="md-form form-sm">
                                    <i class="fas fa-key prefix"></i>
                                    <input placeholder="Enter password" name="password" type="password" id="passwordUser"
                                           class="form-control form-control-sm">
                                    <label for="passwordUser">Password</label>
                                </div>
                                <div class="md-form form-sm">
                                    <i class="fas fa-user prefix"></i>
                                    <input placeholder="Enter name" name="name" type="text" id="nameUser" class="form-control form-control-sm">
                                    <label for="nameUser">Name</label>
                                </div>
                                <div class="md-form form-sm">
                                    <i class="fas fa-envelope prefix"></i>
                                    <input placeholder="Enter email" name="email" type="text" id="emailUser" class="form-control form-control-sm">
                                    <label for="emailUser">Email</label>
                                </div>
                                <div class="md-form form-sm">
                                    <i class="fas fa-envelope prefix"></i>
                                    <input placeholder="Enter phone" name="phone" type="text" id="phoneUser" class="form-control form-control-sm">
                                    <label for="phoneUser">Phone</label>
                                </div>
                                <div class="md-form form-sm">
                                    <label for="userRole">Role</label>
                                    <select name="role" class="mdb-select" id="userRole">
                                        <option value="" disabled selected>Choose role option</option>
                                        <option value="admin">Admin</option>
                                        <option value="user">Client</option>
                                    </select>
                                </div>
                                <div class="md-form form-sm">
                                    <label for="isdelete">Status</label>
                                    <select name="isdelete" class="mdb-select" id="isdelete">
                                        <option value="" disabled selected>Choose status option</option>
                                        <option value="0">Enable</option>
                                        <option value="1">Disable</option>
                                    </select>
                                </div>

                                <div class="text-center mt-1-half">
                                    <button type="button" id="btnsub" class="btn btn-info mb-2">Create <i
                                            class="fas fa-paper-plane ml-1"></i></button>
                                </div>

                            </div>
                        </form>

                    </div>
                    <!-- Content -->
                </div>
            </div>
        </section>
    </div>


</main>
<!-- Main layout -->
<!--Main Layout-->

</body>

<!-- SCRIPTS -->
<!-- JQuery -->
<script th:src="@{/js/jquery-3.4.1.min.js}"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" th:src="@{/js/popper.min.js}"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" th:src="@{/js/bootstrap.js}"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" th:src="@{/js/mdb.min.js}"></script>
<script type="text/javascript" th:src="@{/js/addons/datatables.min.js}"></script>
<script type="text/javascript" th:src="@{/js/addons/datatables-select.min.js}"></script>
<!-- Custom scripts -->
<script>
    $(document).ready(function () {
        var listUser={};
        $('body').ready(loadUser());
        // SideNav Initialization
        $(".button-collapse").sideNav();
        new WOW().init();
        $('.mdb-select').materialSelect();
        $('#btnsub').click(function () {
            var formData = $("#formMaster").serializeObject();
            $.ajax({
                contentType: 'application/json',
                data: JSON.stringify(formData),
                dataType: 'json',
                success: function (data) {
                    toastr.success('Thêm bài viết thành công', '', {positionClass: 'md-toast-top-right'});
                    $('#toast-container').attr('class', 'md-toast-top-right');
                    $("#modalAdd").modal('hide');
                },
                error: function (e) {
                    toastr.danger('Thêm bài viết thất bại', '', {positionClass: 'md-toast-top-right'});
                    $('#toast-container').attr('class', 'md-toast-top-right');
                },
                processData: false,
                type: 'POST',
                url: 'http://localhost:8080/api/save'
            });
            setInterval(loadUser, 1000, 2);

        });
        $.fn.serializeObject = function () {
            var o = {};
            var a = this.serializeArray();
            $.each(a, function () {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
        };
        $(document).on("click","option.fillUser",function () {
            var ob = $(this).val();
            for(var i =0;i<listUser.length;i++){
                if(listUser[i].username==ob){
                    $('#usernameUser').val(listUser[i].username);
                    $('#passwordUser').val(listUser[i].password);
                    $('#nameUser').val(listUser[i].name);
                    $('#emailUser').val(listUser[i].email);
                    $('#phoneUser').val(listUser[i].phone);
                    break;
                }
            }
        });

        function loadUser() {
            $.ajax({
                url: 'http://localhost:8080/api/getlistuser',
                type: 'POST',
                dataType: 'JSON',
                success: function (data) {
                    listUser=data;
                    var tem = '';
                    for (var i = 0; i < data.length; i++) {
                        var cl = listUser[i].stt == 0 ? 'Live' : 'Lock';
                        tem += '<tr>\n' +
                            '<td>' + i + '</td>\n' +
                            '<td class="usernameUser">' + listUser[i].username + '</td>\n' +
                            '<td>' + listUser[i].password + '</td>\n' +
                            '<td>' + listUser[i].name + '</td>\n' +
                            '<td>' + listUser[i].email + '</td>\n' +
                            '<td>' + listUser[i].phone + '</td>\n' +
                            '<td>' + listUser[i].datecreated + '</td>\n' +
                            '<td>' + listUser[i].role + '</td>\n' +
                            '<td>' + cl + '</td>\n' +
                            '<td><option value="'+listUser[i].username+'"  data-toggle="modal" data-target="#modalAdd" type="button" class="btn btn-amber btn-sm fillUser">Edit</option></td>\n' +
                            '</tr>';
                    }
                    $('#dataUser').html(tem);

                },
                error: function (e) {
                    console.log(e.message());
                }
            });
        };
    });


</script>

</html>