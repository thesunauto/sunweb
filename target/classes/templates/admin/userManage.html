<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Material Design Bootstrap</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <!-- Material Design Bootstrap -->
    <link rel="stylesheet" th:href="@{/css/mdb.min.css}">
    <!-- Your custom styles (optional) -->

    <style>
        /* Only for snippet */
        .double-nav .breadcrumb-dn {
            color: #fff;
        }

        .button-collapse i {
            color: #fff
        }
    </style>
    <script src="../../static/js/vendor/datatables/js/dataTables.bootstrap4.min.js"></script>
</head>


<body class="fixed-sn black-skin">

<!--Main Navigation-->
<header>

    <th:block th:include="/admin/_menu"></th:block>

</header>
<!--Main Navigation-->

<!--Main Layout-->
<!-- Main layout  -->
<main class="p-0">
    <div class="container-fluid mb-5">
        <setion>
            <div class="card">
                <div class="card-body">
                    <div class="row">

                        <div class="col-sm">
                            <H3 class="my-auto float-left">List account</H3>
                        </div>
                        <div class="col-sm">
                            <button class="btn btn-success float-right" data-toggle="modal" data-target="#modalAdd">New user</button>
                        </div>
                    </div>
                </div>
            </div>
        </setion>
        <section>

            <div class="card">
                <div class="card-body">

                    <!-- Table -->
                    <table class="table">

                        <!-- Table head -->
                        <thead class="mdb-color darken-3">
                        <tr class="text-white">
                            <th>#</th>
                            <th>Username</th>
                            <th>Password</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Date created</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <!-- Table head -->

                        <!-- Table body -->
                        <tbody id="dataUser">

                        </tbody>
                        <!-- Table body -->
                    </table>
                    <!-- Table -->

                </div>
            </div>

        </section>
        <section>
            <div class="modal fade" id="modalAdd" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog cascading-modal" role="document">
                    <!-- Content -->
                    <div class="modal-content">

                        <!-- Header -->
                        <div class="modal-header light-blue darken-3 white-text">
                            <h4 class=""><i class="fas fa-pencil-alt"></i> Account</h4>
                            <button type="button" class="close waves-effect waves-light" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <!-- Body -->
                        <form id="formMaster">
                            <div class="modal-body mb-0">
                                <div class="md-form form-sm">
                                    <i class="fas fa-user prefix"></i>
                                    <input name="username" type="text" id="form19" class="form-control form-control-sm">
                                    <label for="form19">Username</label>
                                </div>
                                <div class="md-form form-sm">
                                    <i class="fas fa-key prefix"></i>
                                    <input name="password" type="password" id="form129" class="form-control form-control-sm">
                                    <label for="form19">Password</label>
                                </div>
                                <div class="md-form form-sm">
                                    <i class="fas fa-user prefix"></i>
                                    <input  name="name" type="text" id="form19q" class="form-control form-control-sm">
                                    <label for="form19">Name</label>
                                </div>
                                <div class="md-form form-sm">
                                    <i class="fas fa-envelope prefix"></i>
                                    <input  name="email" type="text" id="form230" class="form-control form-control-sm">
                                    <label for="form230">Email</label>
                                </div>
                                <div class="md-form form-sm">
                                    <i class="fas fa-envelope prefix"></i>
                                    <input  name="phone" type="text" id="form210" class="form-control form-control-sm">
                                    <label for="form210">Phone</label>
                                </div>
                                <div class="md-form form-sm">
                                    <select name="role" class="mdb-select">
                                        <option value="" disabled selected>Choose role option</option>
                                        <option value="admin">Admin</option>
                                        <option value="user">Client</option>
                                    </select>
                                </div>


                                <div class="text-center mt-1-half">
                                    <button type="button" id="btnsub" class="btn btn-info mb-2">Create <i class="fas fa-paper-plane ml-1"></i></button>
                                </div>

                            </div>
                        </form>

                    </div>
                    <!-- Content -->
                </div>
            </div>
        </section>
    </div>


</main>
<!-- Main layout -->
<!--Main Layout-->

</body>

<!-- SCRIPTS -->
<!-- JQuery -->
<script th:src="@{/js/jquery-3.4.1.min.js}"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" th:src="@{/js/popper.min.js}"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" th:src="@{/js/bootstrap.js}"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" th:src="@{/js/mdb.min.js}"></script>
<script type="text/javascript" th:src="@{/js/addons/datatables.min.js}"></script>
<script type="text/javascript" th:src="@{/js/addons/datatables-select.min.js}"></script>
<!-- Custom scripts -->
<script>
    $(document).ready(function () {
        $('body').ready(loadUser());
        // SideNav Initialization
        $(".button-collapse").sideNav();
        new WOW().init();
        $('#tblUser').DataTable({
            "pagingType": "full_numbers"
        });
        $('.mdb-select').materialSelect();
        $('#btnsub').click(function () {
            var formData = $("#formMaster").serializeObject();
            console.log(formData)
            $.ajax({
                contentType: 'application/json',
                data: JSON.stringify(formData),
                dataType: 'json',
                success: function(data){
                    loadUser();
                    app.log("device control succeeded");
                },
                error: function(){
                    app.log("Device control failed");
                },
                processData: false,
                type: 'POST',
                url: 'http://localhost:8080/api/save'
            });
        });

    });

    $.fn.serializeObject = function()
    {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (o[this.name] !== undefined) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };

    function loadUser() {
        $.ajax({
            url: 'http://localhost:8080/api/getlistuser',
            type: 'POST',
            dataType: 'JSON',
            success: function (data) {
                var tem = '';
                for (var i = 0; i < data.length; i++) {
                    var cl = data[i].stt==0?'Live':'Lock';
                    tem += '<tr>\n' +
                        '<td>' + i + '</td>\n' +
                        '<td>' + data[i].username + '</td>\n' +
                        '<td>' + data[i].password + '</td>\n' +
                        '<td>' + data[i].name + '</td>\n' +
                        '<td>' + data[i].email + '</td>\n' +
                        '<td>' + data[i].phone + '</td>\n' +
                        '<td>' + data[i].datecreated + '</td>\n' +
                        '<td>' + data[i].role + '</td>\n' +
                        '<td>' + cl + '</td>\n' +
                        '<td><a class="btn btn-amber btn-sm" href="">Edit</a></td>\n' +
                        '</tr>';
                }
                $('#dataUser').html(tem);
            },
            error: function (e) {
                console.log(e.message());
            }
        });
    }
</script>

</html>